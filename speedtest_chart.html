<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Speedtest Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
</head>

<body>
    <canvas id="chart" width="800" height="600"></canvas>

    <script>

        drawChartAsync();

        async function drawChartAsync() {
            const data = await getDataAsync();

            const ctx = document.getElementById('chart').getContext('2d');
            const myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.times,
                    datasets: [{
                        label: 'Download',
                        data: data.downloads,
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: false,
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true,
                                suggestedMax: 70
                            }
                        }],
                    }
                }
            });
        }

        async function getDataAsync() {
            const times = [];
            const downloads = [];
            const uploads = [];

            const response = await fetch('test.csv');
            const data = await response.text();
            const table = data.split('\n').slice(1);
            const mbSpeedRegex = /[0-9]*[0-9].[0-9][0-9]/
            table.forEach(row => {
                const rowArray = row.split(',');
                const time = rowArray[0].slice(12, 17);
                times.push(time);
                downloads.push(rowArray[1].match(mbSpeedRegex));
                uploads.push(rowArray[2].match(mbSpeedRegex));

            })
            return { times, downloads, uploads }
        }

    </script>
</body>

</html>